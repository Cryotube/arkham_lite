# Godot Story: Dice Loop Clarity & Holds

**Epic:** Atmosphere, UX Polish & Live Ops Hooks  
**Story ID:** 4.6  
**Priority:** High  
**Points:** 5  
**Status:** In Progress  
**Language:** GDScript  
**Performance Target:** 60+ FPS

## Description
Deliver Luckitown-style dice ergonomics: clear per-face actions, fast hold/release controls, and immediate feedback when dice become spendable. Extend the current lock rail so players can explicitly “hold” dice to avoid rerolls, preview roll outcomes against available builds, and understand why a die cannot be spent. References: docs/game-prd.md:63, docs/front-end-spec.md:520-552, scenes/ui/run_hud.tscn:254-340, `scripts/ui/run_hud_controller.gd`:13-226, `scripts/systems/dice_subsystem.gd`.

**Godot Implementation:** Enhance dice overlay controls, introduce per-face tooltips and spendability badges, wire holding UX into run flow  
**Performance Impact:** Negligible; badge updates must stay under 0.5 ms per frame

## Acceptance Criteria
- [ ] Each die face displays its build/spell outcome iconography and resource cost alongside the rolled value
- [ ] Holding a die prevents rerolls and is visually differentiated from battle locks (e.g., “Hold” badge vs “Locked” shader)
- [ ] Dice that cannot be spent on current selections show inline reasons (resource shortfall, range, adjacency) via tooltip or badge
- [ ] Quick actions (build/spell buttons) spawn near the board when a held die maps to a valid action, matching the reference mocks
- [ ] Tutorial step or tooltip introduces hold mechanic and analytics capture hold usage events

## Technical Specifications
- Scenes: `run_hud.tscn`, `dice_face_tooltip.tscn`, `dice_hold_badge.tscn`
- Scripts: `run_hud_controller.gd`, `dice_token.gd`, `dice_lock_slot.gd`, `dice_subsystem.gd`, `turn_manager.gd`
- Resources: icon atlas for die faces, tooltip theme updates
- Modified: `dice_viewport.tscn`, `base_theme.tres`
- Systems Changes: add explicit `held` state in `DiceSubsystem` and extend telemetry/tutorial services accordingly
- Dependencies: Tutorial service updates; telemetry pipeline (TelemetryHub) schema change coordination

## Definition of Done
- Acceptance criteria verified in Godot test build, UX captured in updated HUD documentation, automated dice interaction GUT tests expanded to cover hold vs lock behaviors

## Notes
**Orchestrator Progress:** Ready for Phase 4 implementation; assigned to game-developer (Carmack). Track dice loop deliverables via `artifacts/phase4_run_hud_dev_plan.md`.

## Dev Agent Record
- **2024-05-18:** Introduced dedicated hold state in dice subsystem and HUD. Created hold rails/popup wiring, differentiated “Held” vs “Locked” visuals, and added regression tests (`scripts/systems/dice_subsystem.gd`, `scripts/ui/run_hud_controller.gd`, `tests/unit/test_turn_manager.gd`).
