# Godot Story: Visual & Audio Atmosphere Pass

**Epic:** Atmosphere, UX Polish & Live Ops Hooks  
**Story ID:** 4.1  
**Priority:** Medium  
**Points:** 8  
**Status:** Approved  
**Language:** GDScript (plus shaders/resources)  
**Performance Target:** 60+ FPS

## Description
Add ambient particle/lighting effects, tiered graphics settings, and dynamic soundtrack transitions responding to the threat meter while preserving HUD clarity. References: docs/game-prd.md:345-360 and docs/architecture.md:280-380.

**Godot Implementation:** `RenderSettingsService`, `AmbientEffectsController`, and `ThreatMusicController` in typed GDScript with pooled resources  
**Performance Impact:** High; requires tier degradation and profiling to maintain frame budget

## Acceptance Criteria
- [ ] Ambient effects toggle per tier (Performance/Balanced/Atmosphere) with persistence
- [ ] Threat meter states trigger music layer transitions (`Calm`, `Alert`, `Critical`)
- [ ] Graphics settings panel provides live preview and logs telemetry
- [ ] Dice/HUD elements remain legible under all tiers (contrast check)

## Technical Specifications
- Scenes: `ambient_effects.tscn`, `graphics_settings_panel.tscn`
- Scripts: `render_settings_service.gd`, `graphics_settings_panel.gd`, `threat_music_controller.gd`, `ambient_effects_controller.gd`
- Resources: renderer presets, particle presets, music layers, shaders
- Modified: `project.godot`, `run_hud.tscn`, threat/resource autoloads for state signals

## TDD Workflow
- RED: tests for tier switching/persistence + music controller + perf stub
- GREEN: implement tier toggle, audio layering, effect pooling
- REFACTOR: typed tier data, pooling, telemetry logging, CI perf baseline

## Implementation Tasks
- [ ] Write unit tests
- [ ] Implement tier toggles + audio/effect controllers
- [ ] Refactor with typed dicts, pooling, ConfigFile persistence
- [ ] Profile GPU/CPU across tiers to ensure 60+ FPS

**Debug Log:** Table placeholder

## Definition of Done
- Acceptance criteria satisfied; tests and perf checks passing; docs updated with tier guidance
